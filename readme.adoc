= Clean Architecture
:imagesdir: ./images
:doctype: book

ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

image::clean_architecture.png[]
== Les bases de cette architecture

La logique que vous implémentez doit :

* Être indépendante des frameworks : les frameworks et librairies doivent être des outils, sans pour autant vous contraindre.
* Être testable indépendamment : les tests doivent pouvoir être réalisés sans éléments externes (interface utilisateur, base de données ...)
* Être indépendante de l’interface utilisateur : l’interface utilisateur doit pouvoir changer de forme (console, interface web ...)
* Être indépendante de la base de données : il doit être possible de changer de SGBD.
* Être indépendante de tout service ou système externe : en résumé, elle ne doit pas avoir conscience de ce qui l’entoure.

== Définition de la structure du projet

.Steps
. Application : la partie des appels extérieurs
. Business : La partie métier
. Infrastructure : la partie de communication avec les infrastructures de l'entreprise
. Architecture : module qui servira uniquement à mettre en place les règles de contrôle du projet

== Mise en place
[*Revoir le sujet*]

* Création d'un repository git
* Copier le projet exemple dans un repertoire local

== Description des packages pour chaques modules

== Business

=== Les règles

IMPORTANT: Le module **Business** doit-être complétement autonome link:../architecture/src/test/java/org/example/structure/architecture/CheckArchitectureBusinessTest.java[contrôle]

=== Packages

.Composition du module
[options="header,footer"]
|=======================
|   Package    |      implèmentation      | Description
|   services   |  interface adapters.in   | Contient les cases d'usages
|    rules     |                          | Ensemble de régles qui seront utilisées uniquement dans `services`
|    models    |                          | Les classes de données
| adapters.in  |                          | Interfaces pour les cases d'usages
| adapters.out |                          | Interfaces pour le module `infrastructure`
|=======================

=== Schema

image::dia_dep_mod_business.png[]

=== Représentation d'un cas

[IMPORTANT]
A faire

==========================

==========================

== Infrastructure

=== Les règles

CAUTION: Le module **Infrastructure** ne doit avoir uniquement les dépendences suivantes +
implementer une interface du module **Business** du package `adapters.out` +
avec les models module **Business**


=== Packages

.Composition du module
[options="header,footer"]
|=======================
|       Package       |     implèmentation     | Description
|      services       | interface adapters.out | Usages définis dans le module **Business**
|     repository      |                        | Les appels DB
| repository.entities |                        | Les classes de données pour la DB
|  repository.mapper  |                        | Convertisseurs entities/DB -> model de **business**
|        soap         |                        | Les appels en SOAP
|    soap.entities    |                        | Les classes de données pour les appels en SOAP
|     soap.mapper     |                        | Convertisseurs entities/SOAP -> model de **business**
|        rest         |                        | Les appels REST
|    rest.entities    |                        | Les classes de données pour les appels en REST
|     rest.mapper     |                        | Convertisseurs entities/REST -> model de **business**
|=======================
=== Schema

image::dia_dep_infrastructure.png[]

=== Représentation d'un cas
Nous devons développer un service REST qui doit interroger un service du réseau interne
afin de rechercher une personne depuis son id.
Voici la définition des différents éléments dans les modules **business** et **infrastructure** +

image::dia_business_ex.png[]

Le déroulement des différents appels sont sous la forme suivante : +

image::dia_seq_business_ex.png[]
==========================




== Application
=== Les règles

[CAUTION]
===============================
Le module **Application** aura les dépendences suivantes
    module **Business** :
[square]
* les models
    * Les interfaces `adapters.out` et `adapters.in`
    * Les services

module **Infrastructure** :
[square]
    * Les services
===============================
=== Packages
.Composition du module
[options="header,footer"]
|=======================
|       Package       |     implèmentation     | Description
| controllers|| les controleurs de l'application
| services|| Les services qui utiliseront un ou plusieurs services soit du module **business** ou **infrastructure**
|Dtos|| Classes de données
|mapper|| Convertisseurs dto <- -> models(_business_) ou  dto <- -> entitie(_infrastructure_)
|=======================

=== Schema

image::dia_dep_appli.png[]
=== Représentation d'un cas

[IMPORTANT]
A faire
=======================
=======================

== Le Développement
Pour le développement d'une application avec clean architecture,
il faut respecter plusieurs règles.
Ces règles seront en partie contrôlées par la librairie https://www.archunit.org/userguide/html/000_Index.html[ArchUnit]
Ce qui explique la présence du module `Architecture`

=== Case d'usage :
Le sujet sera un magasin, les points qui seront abordés :


[NOTE]
===============================
La liste ci-dessous sera amener à évoluer
===============================

* les bornes d'information : passage du code pour avoir
* le prix du produit Ttc
* le nom

* sans doute le plus important le passage en caisse :
* passage du produit :
* le nom, le prix Ttc
* Ajout dans la liste des produits déjà passés
* Suppression d'un article de la liste des produits
* liste des produits avec le detail
* nombre d'articles , le montant total Ttc
* la liste des articles : code produit, nom, prix Ttc

==== les bornes d'information

____

Au moment du passage du code du produit les informations suivantes doivent s'afficher
* le prix du produit Ttc
* le nom

____

